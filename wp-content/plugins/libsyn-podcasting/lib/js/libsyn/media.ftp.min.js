jQuery(document).ready(function (e) {
	var t;
	e(document.body).on("click.libsynOpenFtpUnreleasedManager", "#libsyn-open-ftp_unreleased", function (n) {
		var removeData = function () {
			e.ajax({
				url: libsyn_nmp_ftp.admin_ajax_url + "?action=remove_ftp_unreleased&remove_ftp_unreleased=1",
				type: 'POST',
				data: libsyn_nmp_ftp.post_id,
				cache: false,
				dataType: 'json',
				processData: false,
				contentType: false,
				success: function (data) {},
				error: function (request, error) {}
			});
		};
		e('#libsyn-new-media-media').clone().attr('type', 'text').insertAfter('#libsyn-new-media-media').prev().remove();
		e.ajax({
			url: libsyn_nmp_ftp.admin_ajax_url + "?action=load_libsyn_media&load_libsyn_media=1",
			type: 'POST',
			data: libsyn_nmp_ftp.post_id,
			cache: false,
			dataType: 'json',
			processData: false,
			contentType: false,
			success: function (data) {
				return n.preventDefault(),
				t ? void t.open() : (t = wp.media.frames.libsyn_media_frame = wp.media({
							className: "media-frame libsyn-ftp_unreleased-frame",
							frame: "select",
							multiple: false,
							title: libsyn_nmp_ftp.title,
							library: {
								type: ["libsyn/ftp-unreleased", "audio/ftp-unreleased", "video/ftp-unreleased"]
							},
							button: {
								text: libsyn_nmp_ftp.button
							}
						}), t.on("select", function () {
						var n = t.state().get("selection").first().toJSON();
						const currentBlock = wp.data.select('core/block-editor').getSelectedBlock();
						if ( !!currentBlock && !!currentBlock.name ) {
							if (currentBlock.name === 'cgb/block-libsyn-podcasting-gutenberg') {
								currentBlock.attributes.libsynNewMediaMedia = n.name;
							}
						}
						e("#libsyn-new-media-media").val(n.name).attr("readonly", true);
						libsyn_nmp_data.libsyn_new_media_media = n.name;
						e.get(libsyn_nmp_ftp.admin_ajax_url + "?action=update_libsyn_postmeta&update_libsyn_postmeta=1&post_id=" + libsyn_nmp_ftp.post_id + "&meta_key=libsyn-new-media-media&meta_value=" + n.name);
						removeData();
					}), void t.open()),
				t.on("close", function () {
					removeData();
				})
			},
			error: function (request, error) {}
		});
	});
});
