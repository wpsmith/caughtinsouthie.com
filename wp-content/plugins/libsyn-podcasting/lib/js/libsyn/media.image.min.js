jQuery(document).ready(function (a) {
	var b;
	a(document.body).on("click.libsynOpenImageManager", "#libsyn-open-image", function (c) {
		c.preventDefault();
		if (b) {
			b.open();
			return
		}
		b = wp.media.frames.libsyn_media_frame = wp.media({
				className: "media-frame libsyn-image-frame",
				frame: "select",
				multiple: false,
				title: libsyn_nmp_image.title,
				library: {
					type: "image"
				},
				button: {
					text: libsyn_nmp_image.button
				}
			});
		b.on("select", function () {
			var d = b.state().get("selection").first().toJSON();
			if ( typeof wp.data != 'undefined' ) {
				var currentBlock = wp.data.select('core/block-editor').getSelectedBlock();
				console.log(wp.data.select('core/block-editor'));
			} else {
				var currentBlock = null;
			}

			if ( !!currentBlock && !!currentBlock.name ) {
				if (currentBlock.name === 'cgb/block-libsyn-podcasting-gutenberg') {
					currentBlock.attributes.libsynNewMediaImage = d.url;
					wp.data.dispatch( 'core/block-editor' ).updateBlockAttributes( currentBlock.clientId, { libsynNewMediaImage: currentBlock.attributes.libsynNewMediaImage } );
				}
			}
			a("#libsyn-new-media-image").val(d.url).attr("readonly", true);
			libsyn_nmp_data.libsyn_new_media_image = d.url;
			a.get(libsyn_nmp_ftp.admin_ajax_url + "?action=update_libsyn_postmeta&update_libsyn_postmeta=1&post_id=" + libsyn_nmp_ftp.post_id + "&meta_key=libsyn-new-media-image&meta_value=" + d.url);
		});
		b.open()
	})
});
