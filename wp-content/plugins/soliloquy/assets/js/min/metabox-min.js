!function(e,t,i,o){"use strict";var l={init:function(){this.select_all(),this.sortable(),this.select(),this.display(),this.chosen(),this.slide_size(),this.uploadImage(),this.toggleStatus(),this.tooltip(),this.sort_slides(),this.clear_selected(),new Clipboard(".soliloquy-clipboard"),e("ul#soliloquy-output").on("click","a.check",function(e){e.preventDefault()}),e(".soliloquy-clipboard").on("click",function(e){e.preventDefault()});var t=e("#soliloquy-output li").length;e(".soliloquy-count").text(t.toString()),e("input,select").conditional()},toggleStatus:function(){e("#soliloquy-settings-content").on("click.soliloquyStatus",".soliloquy-slide-status",function(t){if(t.preventDefault(),e(this).hasClass("list-status"))var i=e(this).parent().parent().parent();else var i=e(this).parent();var l=e(this),s=l.data("status"),a=i.find(".soliloquy-slide-status.list-status"),n=i.find(".soliloquy-slide-status.grid-status"),d=l.parent().parent().data("view"),r=l.data("id"),u=n.find("span.dashicons"),c=a.find("span"),h=l.data("soliloquy-tooltip");if("active"===s)var m="pending";else var m="active";var p={url:o.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_change_slide_status",post_id:o.id,slide_id:r,status:m,nonce:o.save_nonce},success:function(e){"active"===m?(n.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),a.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),u.removeClass("dashicons-hidden").addClass("dashicons-visibility"),c.text(o.active),n.attr("data-soliloquy-tooltip",o.active),a.data("status","active"),n.data("status","active")):(n.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),a.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),u.removeClass("dashicons-visibility").addClass("dashicons-hidden"),c.text(o.draft),a.data("status","pending"),n.data("status","pending"),n.attr("data-soliloquy-tooltip",o.draft))},error:function(e,t,i){}};e.ajax(p)})},tooltip:function(){e("[data-soliloquy-tooltip]").on("mouseover",function(t){t.preventDefault();var i,o=e(this).data("soliloquy-tooltip")})},select_all:function(){e(".soliloquy-select-all").change(function(){var t;if(this.checked){e("ul#soliloquy-output li").addClass("selected"),e(".soliloquy-bulk-actions").fadeIn();var i=e("ul#soliloquy-output li.selected").length;e(".select-all").text(o.selected),e(".soliloquy-count").text(i.toString()),e(".soliloquy-clear-selected").fadeIn()}else{e("ul#soliloquy-output li").removeClass("selected"),e(".soliloquy-bulk-actions").fadeOut();var l=e("ul#soliloquy-output li").length;e(".select-all").text(o.select_all),e(".soliloquy-count").text(l.toString()),e(".soliloquy-clear-selected").fadeOut()}})},sort_slides:function(){e(i).on("change","#soliloquy-config-slide-sort",function(){var t,i=e(this).val(),s={url:o.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_publish",post_id:o.id,order:i,nonce:o.save_nonce},success:function(t){t&&(e("#soliloquy-output").html(t.data),SoliloquySlidesUpdate(),"manual"===i?(console.log(i),e("#soliloquy-output").attr("data-sortable","1")):e("#soliloquy-output").attr("data-sortable","0"),l.sortable())},error:function(e,t,i){}};e.ajax(s)})},sortable:function(){var t=e("#soliloquy-output"),i=t.attr("data-sortable");console.log(i),"1"===i?(t.hasClass("ui-sortable")&&t.sortable("enable"),t.sortable({containment:"#soliloquy-slider-main",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(i,l){var s={url:o.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:t.sortable("toArray").toString(),post_id:o.id,nonce:o.sort},success:function(e){SoliloquySlidesUpdate()},error:function(e,t,i){}};e.ajax(s)}})):t.hasClass("ui-sortable")&&t.sortable("disable")},select:function(){var t=!1,l=!1;e("li.soliloquy-slide .soliloquy-item-content, .soliloquy-list li a.check").on("click",function(i){var s=e(this),a=e(this).parent();if(i.preventDefault(),e(a).hasClass("selected")){e(a).removeClass("selected"),l=!1;var n=e("ul#soliloquy-output li.selected").length;if(0!==n)e(".select-all").text(o.selected),e(".soliloquy-count").text(n.toString()),e(".soliloquy-clear-selected").fadeIn();else{var d=e("ul#soliloquy-output li").length;e(".select-all").text(o.select_all),e(".soliloquy-count").text(d.toString()),e(".soliloquy-clear-selected").fadeOut()}}else{if(t&&!1!==l){var r=e("ul#soliloquy-output li").index(e(l)),u=e("ul#soliloquy-output li").index(e(a)),c=0;if(r<u)for(c=r;c<=u;c++)e("ul#soliloquy-output li:eq( "+c+")").addClass("selected");else for(c=u;c<=r;c++)e("ul#soliloquy-output li:eq( "+c+")").addClass("selected")}e(a).addClass("selected"),l=e(a),n=e("ul#soliloquy-output li.selected").length,e(".soliloquy-clear-selected").fadeIn(),e(".select-all").text(o.selected),e(".soliloquy-count").text(n.toString())}e("ul#soliloquy-output > li.selected").length>0?e(".soliloquy-bulk-actions").fadeIn():e(".soliloquy-bulk-actions").fadeOut()}),e(i).on("keyup keydown",function(e){t=e.shiftKey})},slide_size:function(){e(i).on("change","#soliloquy-config-slider-size",function(){var t=e(this),i=t.val(),l=t.find(":selected").data("soliloquy-width"),s=t.find(":selected").data("soliloquy-height");"default"===i&&(e("#soliloquy-config-slider-width").val(o.slide_width),e("#soliloquy-config-slider-height").val(o.slide_height)),l&&e("#soliloquy-config-slider-width").val(l),s&&e("#soliloquy-config-slider-height").val(s)})},clear_selected:function(){e(".soliloquy-clear-selected").on("click",function(t){t.preventDefault();var i=e("#soliloquy-output li").length;e("ul#soliloquy-output li").removeClass("selected"),e(".select-all").text(o.select_all),e(".soliloquy-count").text(i.toString()),e(".soliloquy-select-all").prop("checked",!1),e(".soliloquy-bulk-actions").fadeOut(),e(this).fadeOut()})},display:function(){e("a.soliloquy-display").on("click",function(t){if(t.preventDefault(),!e(this).hasClass("active-display")){var i=e(this),l=i.data("soliloquy-display"),s=e("#soliloquy-output"),a={url:o.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_slider_view",post_id:o.id,view:l,nonce:o.save_nonce},success:function(e){}};e.ajax(a),e(".soliloquy-display-toggle").find(".active-display").removeClass("active-display"),i.addClass("active-display"),"grid"===l?s.removeClass("soliloquy-list").addClass("soliloquy-grid"):"list"===l&&s.removeClass("soliloquy-grid").addClass("soliloquy-list")}})},chosen:function(){e(".soliloquy-chosen").each(function(){var t=e(this).data("soliloquy-chosen-options");e(this).chosen(t)})},uploadImage:function(){e(".soliloquy-insert-image").on("click",function(t){var i;t.preventDefault();var l,s=e(event.currentTarget).parent().find("input");i?i.open():((i=wp.media.frames.soliloquy_image_frame=wp.media({frame:"select",library:{type:"image"},title:o.insert_image,button:{text:o.insert_image},contentUserSetting:!1,multiple:!1})).on("select",function(){var e=i.state().get("selection").first().toJSON();s.val(e.url)}),i.open())})},updateSlideCount:function(){var t=e("#soliloquy-output li").length;e(".soliloquy-count").text(t.toString()),t>0&&(e("#soliloquy-empty-slider").fadeOut().addClass("soliloquy-hidden"),e(".soliloquy-slide-header").removeClass("soliloquy-hidden").fadeIn(),e(".soliloquy-bulk-actions").fadeOut())}};e(function(){l.init()}),e(i).on("soliloquyType",function(){l.init()}),e(i).on("insertSlides",function(){l.updateSlideCount()})}(jQuery,window,document,soliloquy_metabox),function(e,t,i,o){"use strict";e(function(){e("#soliloquy-types-nav").on("click","li",function(t){e(this).hasClass("soliloquy-active")||e('input[name="_soliloquy[type]"]',e(this)).prop("checked",!0).trigger("change")}),e(i).on("change",'input[name="_soliloquy[type]"]:radio',function(t){var l=e("#soliloquy-tabs #soliloquy-tab-images .spinner"),s=e("#soliloquy-slider-main");e("a",e("#soliloquy-settings-tabs li").first()).trigger("click"),e(s).html(""),e(l).css("visibility","visible"),e("li",e(this).closest("#soliloquy-types-nav")).removeClass("soliloquy-active"),e(this).closest("li").addClass("soliloquy-active"),e.ajax({type:"post",url:o.ajax,dataType:"json",data:{action:"soliloquy_change_type",post_id:o.id,type:e(this).val(),nonce:o.change_nonce},success:function(t){e(s).html(t.html),e(i).trigger("soliloquyType",t),e(l).hide()},error:function(t,i){e(s).html('<div class="error"><p>'+t.responseText+"</p></div>"),e(l).hide()}})})})}(jQuery,window,document,soliloquy_metabox),jQuery(document).ready(function(e){e("a.soliloquy-media-library").on("click",function(t){t.preventDefault(),wp.media.frames.soliloquy?wp.media.frames.soliloquy.open():(wp.media.frames.soliloquy=new wp.media.view.MediaFrame.Post({title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0,library:{type:"image"}}),wp.media.frames.soliloquy.on("open",function(){var t=wp.media.frames.soliloquy.state().get("selection");e("ul#soliloquy-output li").each(function(){var i=wp.media.attachment(e(this).attr("id"));t.add(i?[i]:[])})}),wp.media.frames.soliloquy.on("ready",function(e){}),wp.media.frames.soliloquy.on("insert",function(t){var i=wp.media.frames.soliloquy.state(),o=[];t.each(function(e){var t=i.display(e).toJSON(),l=e.get("type");switch(t.link){case"none":e.set("link","");break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",t.linkUrl)}"image"===l&&o.push(e.toJSON())},this),e.post(soliloquy_metabox.ajax,{action:"soliloquy_insert_slides",nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,images:JSON.stringify(o)},function(t){t&&(e("#soliloquy-output").html(t.data),SoliloquySlidesUpdate(),e(document).trigger("insertSlides"))},"json")}),wp.media.frames.soliloquy.open(),e("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),e("div.media-menu a.media-menu-item:nth-child(3)").addClass("hidden"),e("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"),e("div.media-menu a.media-menu-item:nth-child(6)").addClass("hidden"))})}),jQuery(document).ready(function(e){e("a.soliloquy-slides-delete").click(function(t){var i;if(t.preventDefault(),!confirm(soliloquy_metabox.remove_multiple))return!1;var o=[];e("ul#soliloquy-output > li.selected").each(function(){o.push(e(this).attr("id"))});var l={action:"soliloquy_remove_slides",attachment_ids:o,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};e.post(soliloquy_metabox.ajax,l,function(t){e("ul#soliloquy-output > li.selected").remove(),e(".soliloquy-bulk-actions").fadeOut(),e(".soliloquy-select-all").prop("checked",!1),e(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var i=e("#soliloquy-output li").length;e(".soliloquy-count").text(i.toString()),0===i&&(e(".soliloquy-bulk-actions").fadeOut(),e(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),e("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())},"json")}),e("#soliloquy-settings-content ").on("click",".soliloquy-remove-slide",function(t){var i;if(t.preventDefault(),confirm(soliloquy_metabox.remove)){var o=e(this).parent().attr("id"),l={action:"soliloquy_remove_slide",attachment_id:o,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};e.post(soliloquy_metabox.ajax,l,function(t){e("#"+o).fadeOut("normal",function(){e(this).remove(),e(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var t=e("#soliloquy-output li").length;e(".soliloquy-count").text(t.toString()),0===t&&(e(".soliloquy-bulk-actions").fadeOut(),e(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),e("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())})},"json")}})});var SoliloquySlide=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:"",type:""}}),SoliloquySlides=new Backbone.Collection,SoliloquyModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}}),SoliloquyView=wp.Backbone.View.extend({id:"soliloquy-meta-edit",tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("soliloquy-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","keyup .CodeMirror":"updateCode","blur textarea":"updateItem","change select":"updateItem","click a.soliloquy-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click a.soliloquy-thumbnail":"insertThumb","click a.soliloquy-thumbnail-delete":"removeThumb","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var t=0;this.collection.each(function(e){if(String(e.get("id"))==String(this.attachment_id))return this.model=e,this.attachment_index=t,!1;t++},this)},updateCode:function(e){$model=this.model,$textarea=this.$el.find(".soliloquy-html-slide-code"),$model.set("code",this.editor.getValue(),{silent:!0}),$textarea.text()},insertThumb:function(e){$model=this.model,e.preventDefault();var t=this.$el.data("field"),i=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.videoframe,library:{type:"image"},button:{text:soliloquy_metabox.videouse}});i.on("select",function(){var e=i.state().get("selection").first().toJSON();$model.set("src",e.url,{silent:!0}),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",e.url)}),i.open()},removeThumb:function(e){e.preventDefault(),$model=this.model,$parent=this.$el.parent(),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",""),$model.set("src","",{silent:!0})},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),textarea=this.$el.find(".soliloquy-html-slide-code"),textarea.length&&(this.editor=CodeMirror.fromTextArea(textarea[0],{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"ttcn"})),this.$el.trigger("soliloquyRenderMeta"),this},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&alert(e)},loadPreviousItem:function(){this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(){this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("soliloquy_save_meta",{context:this,data:{nonce:soliloquy_metabox.save_nonce,post_id:soliloquy_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var t=JSON.stringify(this.model.attributes);jQuery("ul#soliloquy-output li#"+this.model.get("id")).attr("data-soliloquy-image-model",t);var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),SoliloquyChildViews=[],SoliloquyContentViews=[];function SoliloquySlidesUpdate(e){var t;SoliloquySlides.reset(),jQuery("ul#soliloquy-output li.soliloquy-slide"+(e?".selected":"")).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-soliloquy-image-model"));SoliloquySlides.add(new SoliloquySlide(e))})}!function(e){e(document).ready(function(){soliloquy_edit={init:function(){SoliloquySlidesUpdate(),e("#soliloquy-settings-content").on("click.soliloquyModify",".soliloquy-modify-slide",function(t){t.preventDefault();var i=e(this).parent().data("soliloquy-slide");SoliloquyModalWindow.content(new SoliloquyView({collection:SoliloquySlides,child_views:SoliloquyChildViews,attachment_id:i})),e(document).trigger("soliloquyRenderMeta"),SoliloquyModalWindow.open(),e(document).trigger("soliloquyEditOpen"),e(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})})}},soliloquy_edit.init()}),e(document).on("soliloquyUploaded",function(){soliloquy_edit.init()})}(jQuery),function(e,t,i){wp.media.view.SoliloquyHTMLError=wp.Backbone.View.extend({tagName:"div",className:"soliloquy-error soliloquy-html-error",render:function(){return this.template=wp.media.template("soliloquy-html-error"),this.$el.html(this.template(this.model)),this}}),wp.media.model.SoliloquyHTML=Backbone.Model.extend({defaults:{title:"",code:""}}),wp.media.view.SoliloquyHTMLItem=wp.Backbone.View.extend({tagName:"li",className:"attachment soliloquy-html-attachment",events:{"keyup input":"updateItem","keyup textarea":"updateItem","blur .Codemirror":"updateCode","click .soliloquy-delete-html-slide":"deleteItem","click .soliloquy-item-collapse":"collapse"},initialize:function(){this.model.view=this},collapse:function(t){var i=e(this.$el);$text=i.find(".soliloquy-item-collapse"),t.preventDefault(),i.find(".soliloquy-item-setting").not(".title").is(":visible")?($text.text(soliloquy_metabox.expand),i.find(".soliloquy-item-setting").not(".title").fadeOut()):($text.text(soliloquy_metabox.collapse),i.find(".soliloquy-item-setting").not(".title").fadeIn())},updateCode:function(e){},updateItem:function(e){this.model.set(e.target.name,e.target.value,{silent:!0})},deleteItem:function(e){var t;this.trigger("loading"),jQuery(e.target).parent().parent().parent().remove(),this.model.destroy(),this.trigger("loaded loaded:success")},updateCode:function(e){},render:function(){this.template=wp.media.template("soliloquy-html-item"),this.$el.html(this.template(this.model.toJSON()));var e=this.$el.find(".soliloquy-html-slide-code");return this.editor=CodeMirror.fromTextArea(e[0],{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"ttcn"}),this.editor.on("blur",function(t){this.model.set("code",t.getValue(),{silent:!0}),e.text(t.getValue())}),this}}),wp.media.view.Toolbar.SoliloquyHTML=wp.media.view.Toolbar.extend({initialize:function(){_.defaults(this.options,{event:"soliloquy_html_insert",close:!1,items:{soliloquy_html_insert:{id:"soliloquy-html-button",style:"primary",text:wp.media.view.l10n.insertIntoPost,priority:80,requires:!1,click:function(){this.controller.state().SoliloquyHTMLInsert()}}}}),wp.media.view.Toolbar.prototype.initialize.apply(this,arguments)},refresh:function(){this.get("soliloquy_html_insert").model.set("disabled",!1),wp.media.view.Toolbar.prototype.refresh.apply(this,arguments)}}),wp.media.view.SoliloquyHTML=wp.media.View.extend({events:{"click .soliloquy-html-add":"addItem",change:"refreshView"},initialize:function(){this.collection=new Backbone.Collection,this.is_loading=!1,this.$el.prepend(wp.media.template("soliloquy-html-router")),this.$el.prepend(wp.media.template("soliloquy-html-side-bar")),this.$el.prepend(wp.media.template("soliloquy-html-items")),this.addItem(),setTimeout(function(){e(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})},100),this.on("loading",this.loading,this),this.on("loaded",this.loaded,this)},loading:function(){this.is_loading=!0,this.$el.find(".spinner").addClass("is-active")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").removeClass("is-active"),this.$el.find("div.soliloquy-error").remove(),"object"==typeof e&&(e=e.responseText),void 0!==e&&(this.$el.find("div.media-toolbar-secondary").append(this.renderError(e)),this.$el.find("ul.attachments.soliloquy-html-attachments").css("margin-top",this.$el.find("div.soliloquy-error").height()+20)),this.controller.toolbar.get().refresh()},clearItems:function(){this.$el.find("ul.soliloquy-html-attachments").empty()},renderError:function(e){var t={},i;return t.error=e,new wp.media.view.SoliloquyHTMLError({model:t}).render().el},addItem:function(t){this.trigger("loading"),model=new wp.media.model.SoliloquyHTML,this.getSelection().add(model);var i=new wp.media.view.SoliloquyHTMLItem({model:model,controller:this});this.$el.find("ul.soliloquy-html-attachments").append(i.render().el),e(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()}),this.trigger("loaded loaded:success")},refreshView:function(e){},getSelection:function(){return this.controller.state().props},clearSelection:function(){this.selection=this.getSelection(),jQuery("li.attachment.soliloquy-html-attachment").remove(),this.selection.reset()}});var o=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),this.states.add([new wp.media.controller.SoliloquyHTML({id:"soliloquy-html",content:"soliloquy-html-content",toolbar:"soliloquy-html-toolbar",menu:"default",title:wp.media.view.l10n.SoliloquyHTMLTitle,priority:200,type:"link"})]),this.on("content:render:soliloquy-html-content",this.renderSoliloquyHTMLContent,this),this.on("toolbar:create:soliloquy-html-toolbar",this.createSoliloquyHTMLToolbar,this)},renderSoliloquyHTMLContent:function(){this.content.set(new wp.media.view.SoliloquyHTML({controller:this,model:this.state().props,className:"attachments-browser soliloquy soliloquy-html"}))},createSoliloquyHTMLToolbar:function(e){e.view=new wp.media.view.Toolbar.SoliloquyHTML({controller:this})}}),wp.media.controller.SoliloquyHTML=wp.media.controller.State.extend({initialize:function(e){this.props=new Backbone.Collection},SoliloquyHTMLInsert:function(){var t=this.frame.content.get(),o=[],l=!0;if(this.button=this.frame.toolbar.get().get("soliloquy_html_insert"),this.button.model.set("text",wp.media.view.l10n.inserting),this.button.model.set("disabled",!0),t.trigger("loading"),t.getSelection().each(function(e){""==e.get("title")&&(l=!1),""==e.get("code")&&(l=!1),o.push(e.toJSON())},this),!l)return t.trigger("loaded loaded:error",wp.media.view.l10n.SoliloquyHTMLValidationError),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),!1;wp.media.ajax("soliloquy_insert_slides",{context:this,data:{nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,html:o},success:function(o){jQuery("#soliloquy-output").html(o),t.trigger("loaded loaded:success"),SoliloquySlidesUpdate(),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),e(i).trigger("insertSlides"),t.clearSelection(),this.frame.close()},error:function(e){this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),t.trigger("loaded loaded:error",e)}})}})}(jQuery,window,document);var SoliloquyBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("soliloquy-meta-bulk-editor-slides"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),SoliloquyBulkEditView=wp.Backbone.View.extend({id:"soliloquy-meta-edit-bulk",tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("soliloquy-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.soliloquy-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.model=new SoliloquySlide},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var t=new SoliloquyBulkEditImageView({model:e});this.$el.find("ul.attachments").append(t.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},100),wpLink.init,this},renderError:function(e){var t={},i;return t.error=e,new wp.media.view.SoliloquyError({model:t}).render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(){this.trigger("loading");var e=[];this.collection.forEach(function(t){e.push(t.id)},this),wp.media.ajax("soliloquy_bulk_save_meta",{context:this,data:{nonce:soliloquy_metabox.save_nonce,post_id:soliloquy_metabox.id,meta:this.model.attributes,image_ids:e},success:function(e){this.collection.forEach(function(e){for(var t in this.model.attributes)value=this.model.attributes[t],value.length>0&&e.set(t,value);var i=JSON.stringify(e.attributes);jQuery("ul#soliloquy li#"+e.get("id")).attr("data-solioquy-image-model",i),jQuery("ul#soliloquy li#"+e.get("id")+" div.title").text(e.get("title"))},this),this.trigger("loaded loaded:success"),SoliloquyModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function(e){e("#soliloquy-settings-content").on("click","a.soliloquy-slides-edit",function(e){e.preventDefault(),SoliloquySlidesUpdate(!0),SoliloquyModalWindow.content(new SoliloquyBulkEditView({collection:SoliloquySlides,child_views:SoliloquyChildViews})),SoliloquyModalWindow.open()})}),function(e,t,i,o){wp.media.view.SoliloquyVideosError=wp.Backbone.View.extend({tagName:"div",className:"soliloquy-error soliloquy-videos-error",render:function(){return this.template=wp.media.template("soliloquy-video-error"),this.$el.html(this.template(this.model)),this}}),wp.media.model.SoliloquyVideo=Backbone.Model.extend({defaults:{title:"",url:"",src:"",caption:"",alt:"",hosted_video:!1}}),wp.media.view.SoliloquyVideosItem=wp.Backbone.View.extend({tagName:"li",className:"attachment soliloquy-videos-attachment",events:{"keyup input":"updateItem","keyup textarea":"updateItem","click .soliloquy-delete-video-slide":"deleteItem","click .soliloquy-insert-video":"insertVideo","click .soliloquy-insert-placeholder":"insertPlaceholder","click .soliloquy-item-collapse":"collapse"},initialize:function(){this.model.view=this},collapse:function(t){var i=e(this.$el);$text=i.find(".soliloquy-item-collapse"),t.preventDefault(),i.find(".soliloquy-item-setting").not(".title").is(":visible")?($text.text(o.expand),i.find(".soliloquy-item-setting").not(".title").fadeOut()):($text.text(o.collapse),i.find(".soliloquy-item-setting").not(".title").fadeIn())},updateItem:function(e){this.model.set(e.target.name,e.target.value,{silent:!0}),"url"==e.target.name&&(""==e.target.value?this.model.set("hosted_video",!1):wp.media.ajax("soliloquy_is_hosted_video",{context:this,data:{nonce:o.hosted_nonce,video_url:e.target.value},success:function(e){e?this.model.set("hosted_video",!0):this.model.set("hosted_video",!1)},error:function(e){this.model.set("hosted_video",!1),this.frame.content.get().trigger("loaded loaded:error",e)}}))},insertVideo:function(t){var i,l=this.model;t.preventDefault();var s,a=e(t.currentTarget).parent().parent().find("input");i?i.open():((i=wp.media.frames.soliloquy_video_frame=wp.media({frame:"select",library:{type:"video"},title:o.insert_video,button:{text:o.insert_video},contentUserSetting:!1,multiple:!1})).on("select",function(){attachment=i.state().get("selection").first().toJSON(),$value=a.val(attachment.url),l.set("url",attachment.url,{silent:!0})}),i.open())},insertPlaceholder:function(t){var i,l=this.model;t.preventDefault();var s,a=e(t.currentTarget).parent().parent().find("input");i?i.open():((i=wp.media.frames.soliloquy_placeholder_frame=wp.media({frame:"select",library:{type:"image"},title:o.insert_placeholder,button:{text:o.insert_placeholder},contentUserSetting:!1,multiple:!1})).on("select",function(){attachment=i.state().get("selection").first().toJSON(),a.val(attachment.url),l.set("src",attachment.url,{silent:!0})}),i.open())},deleteItem:function(e){var t;this.trigger("loading"),jQuery(e.target).parent().parent().parent().remove(),this.model.destroy(),this.trigger("loaded loaded:success")},render:function(){return this.template=wp.media.template("soliloquy-video-item"),this.$el.html(this.template(this.model.toJSON())),this}}),wp.media.view.Toolbar.SoliloquyVideos=wp.media.view.Toolbar.extend({initialize:function(){_.defaults(this.options,{event:"soliloquy_videos_insert",close:!1,items:{soliloquy_videos_insert:{id:"soliloquy-videos-button",style:"primary",text:wp.media.view.l10n.insertIntoPost,priority:80,requires:!1,click:function(){this.controller.state().SoliloquyVideosInsert()}}}}),wp.media.view.Toolbar.prototype.initialize.apply(this,arguments)},refresh:function(){this.get("soliloquy_videos_insert").model.set("disabled",!1),wp.media.view.Toolbar.prototype.refresh.apply(this,arguments)}}),wp.media.view.SoliloquyVideos=wp.media.View.extend({events:{"click .soliloquy-videos-add":"addItem",change:"refreshView"},initialize:function(){this.collection=new Backbone.Collection,this.is_loading=!1,this.$el.prepend(wp.media.template("soliloquy-video-router")),this.$el.prepend(wp.media.template("soliloquy-video-side-bar")),this.$el.prepend(wp.media.template("soliloquy-video-items")),this.addItem(),this.on("loading",this.loading,this),this.on("loaded",this.loaded,this)},
loading:function(){this.is_loading=!0,this.$el.find(".spinner").addClass("is-active")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").removeClass("is-active"),this.$el.find("div.soliloquy-error").remove(),"object"==typeof e&&(e=e.responseText),void 0!==e&&(this.$el.find("div.media-toolbar-secondary").append(this.renderError(e)),this.$el.find("ul.attachments.soliloquy-videos-attachments").css("margin-top",this.$el.find("div.soliloquy-error").height()+20)),this.controller.toolbar.get().refresh()},clearItems:function(){this.$el.find("ul.soliloquy-videos-attachments").empty()},renderError:function(e){var t={},i;return t.error=e,new wp.media.view.SoliloquyVideosError({model:t}).render().el},addItem:function(e){this.trigger("loading"),model=new wp.media.model.SoliloquyVideo,this.getSelection().add(model);var t=new wp.media.view.SoliloquyVideosItem({model:model,controller:this});this.$el.find("ul.soliloquy-videos-attachments").append(t.render().el),setTimeout(function(){quicktags({id:"caption-video",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),this.trigger("loaded loaded:success")},refreshView:function(e){this.model.each(function(e){e.get("hosted_video")?e.view.$el.find("div.image").fadeIn():e.view.$el.find("div.image").fadeOut()})},getSelection:function(){return this.controller.state().props},clearSelection:function(){this.selection=this.getSelection(),jQuery("li.attachment.soliloquy-videos-attachment").remove(),this.selection.reset()}});var l=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=l.extend({initialize:function(){l.prototype.initialize.apply(this,arguments),this.states.add([new wp.media.controller.SoliloquyVideos({id:"soliloquy-videos",content:"soliloquy-videos-content",toolbar:"soliloquy-videos-toolbar",menu:"default",title:wp.media.view.l10n.soliloquyVideosTitle,priority:200,type:"link"})]),this.on("content:render:soliloquy-videos-content",this.renderSoliloquyVideosContent,this),this.on("toolbar:create:soliloquy-videos-toolbar",this.createSoliloquyVideosToolbar,this)},renderSoliloquyVideosContent:function(){this.content.set(new wp.media.view.SoliloquyVideos({controller:this,model:this.state().props,className:"attachments-browser soliloquy soliloquy-videos"}))},createSoliloquyVideosToolbar:function(e){e.view=new wp.media.view.Toolbar.SoliloquyVideos({controller:this})}}),wp.media.controller.SoliloquyVideos=wp.media.controller.State.extend({initialize:function(e){this.props=new Backbone.Collection},renderError:function(e){var t={},i;return t.error=e,new wp.media.view.SoliloquyVideosError({model:t}).render().el},SoliloquyVideosInsert:function(){var t=this.frame.content.get(),l=[],s=!0;if(this.button=this.frame.toolbar.get().get("soliloquy_videos_insert"),this.button.model.set("text",wp.media.view.l10n.inserting),this.button.model.set("disabled",!0),t.trigger("loading"),t.getSelection().each(function(e){""===e.get("title")&&(s=!1),""===e.get("url")&&(s=!1),e.get("hosted_video")&&""===e.get("src")&&(s=!1),l.push(e.toJSON())},this),!s)return t.trigger("loaded loaded:error",wp.media.view.l10n.soliloquyVideosValidationError),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),!1;wp.media.ajax("soliloquy_insert_slides",{context:this,data:{nonce:o.insert_nonce,post_id:o.id,videos:l},success:function(o){jQuery("#soliloquy-output").html(o),t.trigger("loaded loaded:success"),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),SoliloquySlidesUpdate(),e(i).trigger("insertSlides"),t.clearSelection(),this.frame.close()},error:function(i){this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),e(".soliloquy-videos").find("div.media-toolbar-secondary").append(this.renderError(i.statusText)),t.trigger("soliloquy-loaded soliloquy-loaded:error",i.statusText)}})}})}(jQuery,window,document,soliloquy_metabox),function(e,t,i){"use strict";var o=t.location.hash,l=t.location.hash.replace("!","");if(o&&o.indexOf("soliloquy-tab")>=0){var s=e(l.replace("tab_","")),a=s.parent(),n=s.parent().parent().find("ul.soliloquy-tabs-nav"),d=e("#post").attr("action");a.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),s.addClass("soliloquy-tab-active"),n.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),n.find('a[href="'+l.replace("tab_","")+'"]').parent().addClass("soliloquy-tab-nav-active"),d&&(d=d.split("#")[0],e("#post").attr("action",d+t.location.hash)),e("body").trigger("SoliloquyTabChange")}e(function(){e("[data-soliloquy-tab]").on("click",function(i){i.preventDefault();var o=e(this),l=o.attr("data-tab-id"),s=o.parent(),a=s.parent(),n=s.attr("data-update-hashbang"),d=void 0!==o.attr("href")?"tab_"+o.attr("href"):"tab_"+l;if(!o.hasClass("soliloquy-tab-nav-active")){if(a.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),s.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),o.addClass("soliloquy-tab-nav-active"),e("#"+l).addClass("soliloquy-tab-active"),o.trigger("SoliloquyTabChange"),"soliloquy-native"===l&&!0!==e("#soliloquy-type-default").prop("checked")&&(e("#soliloquy-types-nav li").removeClass("soliloquy-active"),e("#soliloquy-type-default").prop("checked",!0).trigger("change")),"1"===n){t.location.hash=d.split("#").join("#!");var r=e("#post").attr("action");r&&(r=r.split("#")[0],e("#post").attr("action",r+t.location.hash))}return!1}})})}(jQuery,window,document);